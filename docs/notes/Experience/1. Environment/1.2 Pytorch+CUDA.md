---
title:  1.2 Pytorch+CUDA
createTime: 2025/04/20 14:27:07
permalink: /experience/a5k8sy7u/
---

## 1.2.1 H20/H100ç±»æ˜¾å¡é—®é¢˜

è¿™ç±»æ˜¾å¡ä¸º**Hopperæ¶æ„**ï¼Œè®¡ç®—èƒ½åŠ› `sm_90`ï¼ŒCUDAç‰ˆæœ¬å¿…é¡» >= 11.8

GPU æ‰€éœ€çš„æœ€ä½ CUDA ç‰ˆæœ¬ï¼š[https://stackoverflow.com/questions/28932864/which-compute-capability-is-supported-by-which-cuda-versions/28933055#28933055](https://stackoverflow.com/questions/28932864/which-compute-capability-is-supported-by-which-cuda-versions/28933055#28933055)

## 1.2.2 NVdiffrast CUDA11.8é—®é¢˜

[https://github.com/NVlabs/nvdiffrast/issues/138](https://github.com/NVlabs/nvdiffrast/issues/138)

ä¸»è¦é—®é¢˜ï¼š

```bash
nvcc error   : 'ptxas' died due to signal 11 (Invalid memory reference)
nvcc error   : 'ptxas' core dumped
```

è§£å†³åŠæ³•ï¼šå‡çº§CUDAç‰ˆæœ¬ğŸ˜­ï¼Œå‡çº§åˆ°12.1å°±è§£å†³äº†ï¼ˆæ³¨æ„ï¼Œæœ€å¥½è¿˜æ˜¯ä¸è¦ç”¨Conda çš„CUDAï¼Œç»å¸¸å‡ºç°æ‰¾ä¸åˆ°CUDAç¯å¢ƒçš„é—®é¢˜ï¼‰

## 1.2.3 Condaå®‰è£…CUDA/GCC

åœ¨æ–°æœåŠ¡å™¨ä¸Šé…ç½®ç¯å¢ƒï¼š

1. å®‰è£… mambaï¼ˆæ¯” conda æ›´å¿«ï¼‰

   ```bash
   wget "https://github.com/conda-forge/miniforge/releases/latest/download/Miniforge3-$(uname)-$(uname -m).sh"
   bash Miniforge3-$(uname)-$(uname -m).sh
   ```

2. åˆ›å»ºç¯å¢ƒ

   ```bash
   mamba create -n h_gs python=3.12 -y
   mamba install pytorch==2.3.0 torchvision==0.18.0 torchaudio==2.3.0 pytorch-cuda=12.1 -c pytorch -c nvidia/label/cuda-12.1.0
   ```

3. å®‰è£… GCC/G++

   ```bash
   mamba install gcc=11.4
   mamba install gxx=11.4
   ```

4. å®‰è£… CUDA

   conda å®‰è£…CUDAå„ç‰ˆæœ¬å‘½ä»¤ï¼š[https://anaconda.org/nvidia/cuda-toolkit](https://anaconda.org/nvidia/cuda-toolkit)

   ```bash
   mamba install nvidia/label/cuda-12.1.0::cuda-toolkit -c nvidia/label/cuda-12.1.0
   ```

æ³¨æ„ï¼šCondaçš„CUDAï¼Œç»å¸¸å‡ºç°æ‰¾ä¸åˆ°CUDAç¯å¢ƒçš„é—®é¢˜

[https://stackoverflow.com/questions/72684130/how-to-set-the-cuda-path-in-the-conda-environment](https://stackoverflow.com/questions/72684130/how-to-set-the-cuda-path-in-the-conda-environment)

[https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html#saving-environment-variables](https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html#saving-environment-variables)

1. è¿›å…¥Condaç¯å¢ƒç›®å½•å¹¶åˆ›å»ºä»¥ä¸‹å­ç›®å½•å’Œæ–‡ä»¶ï¼š

   ```bash
   cd $CONDA_PREFIX
   mkdir -p ./etc/conda/activate.d
   mkdir -p ./etc/conda/deactivate.d
   touch ./etc/conda/activate.d/env_vars.sh
   touch ./etc/conda/deactivate.d/env_vars.sh
   ```

2. ç¼–è¾‘ `./etc/conda/activate.d/env_vars.sh` å¦‚ä¸‹ï¼š

   ```bash
   #!/bin/sh
   
   export CUDA_HOME=$CONDA_PREFIX
   export LD_LIBRARY_PATH=$CONDA_PREFIX/lib:$LD_LIBRARY_PATH
   ```

3. ç¼–è¾‘ `./etc/conda/deactivate.d/env_vars.sh` å¦‚ä¸‹ï¼š

   ```bash
   #!/bin/sh
   
   unset CUDA_HOME
   unset LD_LIBRARY_PATH
   ```

å½“è¿è¡Œ `conda activate analytics` æ—¶ï¼Œç¯å¢ƒå˜é‡ `MY_KEY` å’Œ `MY_FILE` å°†è®¾ç½®ä¸ºå†™å…¥æ–‡ä»¶çš„å€¼ã€‚å½“è¿è¡Œ `conda deactivate` æ—¶ï¼Œè¿™äº›ç¯å¢ƒå˜é‡å°†è¢«åˆ é™¤ã€‚

## 1.2.4 undefined symbol: iJIT_NotifyEvent

```bash
Traceback (most recent call last):
  File "/mnt/data4/home/xxxx/GPAvatar/inference.py", line 11, in <module>
    import torch
  File "/mnt/data/home/xxxx/miniforge3/envs/GPAvatar/lib/python3.9/site-packages/torch/__init__.py", line 229, in <module>
    from torch._C import *  # noqa: F403
ImportError: /mnt/data/home/xxxx/miniforge3/envs/GPAvatar/lib/python3.9/site-packages/torch/lib/libtorch_cpu.so: undefined symbol: iJIT_NotifyEvent
```

[https://github.com/pytorch/pytorch/issues/123097](https://github.com/pytorch/pytorch/issues/123097)

åœ¨ä»¥ä¸‹ç¯å¢ƒæ—¶ `import torch` å‘ç”Ÿçš„bugï¼š

```bash
mamba install pytorch==2.0.0 torchvision==0.15.0 torchaudio==2.0.0 pytorch-cuda=11.8 -c pytorch -c nvidia
mamba install nvidia/label/cuda-11.8.0::cuda-toolkit -c nvidia/label/cuda-11.8.0
```

æ­¤æ—¶çš„ `mkl=2024.2.2`ï¼Œæˆ‘ä»¬å°†å…¶é™çº§ä¸º `mkl=2024.0`

```bash
mamba install mkl==2024.0
```

## 1.2.5 ld: cannot find -lcudart

æˆ‘ä»¬ä½¿ç”¨  2.2.3 çš„æµç¨‹å®‰è£…pytorchå’ŒCUDAç¯å¢ƒä¹‹åï¼Œè¦ç”¨ conda çš„CUDAç¯å¢ƒè¿›è¡ŒæŸä¸ªåº“ç¼–è¯‘æ—¶ï¼Œå‡ºç°äº†bugï¼š

```bash
/mnt/data/home/xxxx/miniforge3/envs/GAGAvatar/compiler_compat/ld: cannot find -lcudart: No such file or directory
      collect2: error: ld returned 1 exit status
      error: command '/mnt/data/home/xxxx/miniforge3/envs/GAGAvatar/bin/g++' failed with exit code 1
      [end of output]

  note: This error originates from a subprocess, and is likely not a problem with pip.
  ERROR: Failed building wheel for diff_gaussian_rasterization_32d
  Running setup.py clean for diff_gaussian_rasterization_32d
Failed to build diff_gaussian_rasterization_32d
ERROR: ERROR: Failed to build installable wheels for some pyproject.toml based projects (diff_gaussian_rasterization_32d)
â¯ which nvcc
/mnt/data/home/xxxx/miniforge3/envs/GAGAvatar/bin/nvcc
â¯ echo $CUDA_HOME
/mnt/data/home/xxxx/miniforge3/envs/GAGAvatar
â¯ echo $PATH
/home/xxxx/local/bin:/home/xxxx/local/bin:/mnt/data/home/xxxx/miniforge3/envs/GAGAvatar/bin:/mnt/data/home/xxxx/miniforge3/condabin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin
â¯ echo $LD_LIBRARY_PATH
/mnt/data/home/xxxx/miniforge3/envs/GAGAvatar/lib:
```

å»æ¢æŸ¥å‘ç°ï¼Œè¿™é‡Œçš„è½¯é“¾æ¥å‡ºäº†é—®é¢˜ï¼š

```bash
â¯ ls /mnt/data/home/xxxx/miniforge3/envs/GAGAvatar/lib

libcudart.so  -> libcudart.so.12.1.55
libcudart.so.12
libcudart.so.12.1.105
```

ç»§ç»­æ¢ç©¶å‘ç°ï¼Œå®‰è£…Pytorchæ—¶ä¼šå®‰è£… `cuda-cudart=12.1.105`

ä»¥ä¸‹æ˜¯æŒ‰ç…§Pytorchæ—¶ä¼šå®‰è£…çš„æ‰€æœ‰ä»¥ `pytorch` ã€ `nvidia` ä¸º channel çš„åŒ…ï¼š

```bash
  + pytorch-mutex         1.0  cuda                          pytorch     Cached
  + libcublas       12.1.0.26  0                             nvidia      Cached
  + libcufft         11.0.2.4  0                             nvidia      Cached
  + libcusolver     11.4.4.55  0                             nvidia      Cached
  + libcusparse     12.0.2.55  0                             nvidia      Cached
  + libnpp          12.0.2.50  0                             nvidia      Cached
  + cuda-cudart      12.1.105  0                             nvidia      Cached
  + cuda-nvrtc       12.1.105  0                             nvidia      Cached
  + libnvjitlink     12.1.105  0                             nvidia      Cached
  + libnvjpeg       12.1.1.14  0                             nvidia      Cached
  + cuda-cupti       12.1.105  0                             nvidia      Cached
  + cuda-nvtx        12.1.105  0                             nvidia      Cached
  + ffmpeg                4.3  hf484d3e_0                    pytorch     Cached
  + libjpeg-turbo       2.0.0  h9bf148f_0                    pytorch     Cached
  + cuda-version         12.6  3                             nvidia      Cached
  + libcurand       10.3.7.77  0                             nvidia      Cached
  + libcufile        1.11.1.6  0                             nvidia      Cached
  + cuda-opencl       12.6.77  0                             nvidia      Cached
  + cuda-libraries     12.1.0  0                             nvidia      Cached
  + cuda-runtime       12.1.0  0                             nvidia      Cached
  + pytorch-cuda         12.1  ha16c6d3_6                    pytorch     Cached
  + pytorch             2.4.1  py3.12_cuda12.1_cudnn9.1.0_0  pytorch     Cached
  + torchtriton         3.0.0  py312                         pytorch     Cached
  + torchaudio          2.4.1  py312_cu121                   pytorch     Cached
  + torchvision        0.19.1  py312_cu121                   pytorch     Cached
```

è€Œè¿™æ˜¯å®‰è£… `cuda-toolkit-12.1.0` çš„åŒ…ï¼š

```bash
  + cuda-documentation           12.1.55  0      nvidia/label/cuda-12.1.0     Cached
  + cuda-nvml-dev                12.1.55  0      nvidia/label/cuda-12.1.0     Cached
  + libnvvm-samples              12.1.55  0      nvidia/label/cuda-12.1.0     Cached
  + cuda-cccl                    12.1.55  0      nvidia/label/cuda-12.1.0     Cached
  + cuda-driver-dev              12.1.55  0      nvidia/label/cuda-12.1.0     Cached
  + cuda-profiler-api            12.1.55  0      nvidia/label/cuda-12.1.0     Cached
  + cuda-cudart                  12.1.55  0      nvidia/label/cuda-12.1.0     Cached
  + cuda-nvrtc                   12.1.55  0      nvidia/label/cuda-12.1.0       21MB
  + cuda-opencl                  12.1.56  0      nvidia/label/cuda-12.1.0       11kB
  + libcublas                  12.1.0.26  0      nvidia/label/cuda-12.1.0     Cached
  + libcufft                    11.0.2.4  0      nvidia/label/cuda-12.1.0     Cached
  + libcufile                   1.6.0.25  0      nvidia/label/cuda-12.1.0      782kB
  + libcurand                  10.3.2.56  0      nvidia/label/cuda-12.1.0       54MB
  + libcusolver                11.4.4.55  0      nvidia/label/cuda-12.1.0     Cached
  + libcusparse                12.0.2.55  0      nvidia/label/cuda-12.1.0     Cached
  + libnpp                     12.0.2.50  0      nvidia/label/cuda-12.1.0     Cached
  + libnvjitlink                 12.1.55  0      nvidia/label/cuda-12.1.0       18MB
  + libnvjpeg                  12.1.0.39  0      nvidia/label/cuda-12.1.0        3MB
  + cuda-cupti                   12.1.62  0      nvidia/label/cuda-12.1.0        5MB
  + cuda-cuobjdump               12.1.55  0      nvidia/label/cuda-12.1.0     Cached
  + cuda-cuxxfilt                12.1.55  0      nvidia/label/cuda-12.1.0     Cached
  + cuda-nvcc                    12.1.66  0      nvidia/label/cuda-12.1.0     Cached
  + cuda-nvprune                 12.1.55  0      nvidia/label/cuda-12.1.0     Cached
  + cuda-gdb                     12.1.55  0      nvidia/label/cuda-12.1.0     Cached
  + cuda-nvdisasm                12.1.55  0      nvidia/label/cuda-12.1.0     Cached
  + cuda-nvprof                  12.1.55  0      nvidia/label/cuda-12.1.0     Cached
  + cuda-nvtx                    12.1.66  0      nvidia/label/cuda-12.1.0       58kB
  + cuda-sanitizer-api           12.1.55  0      nvidia/label/cuda-12.1.0     Cached
  + cuda-nsight                  12.1.55  0      nvidia/label/cuda-12.1.0     Cached
  + nsight-compute           2023.1.0.15  0      nvidia/label/cuda-12.1.0     Cached
  + cuda-cudart-dev              12.1.55  0      nvidia/label/cuda-12.1.0     Cached
  + cuda-nvrtc-dev               12.1.55  0      nvidia/label/cuda-12.1.0     Cached
  + cuda-opencl-dev              12.1.56  0      nvidia/label/cuda-12.1.0     Cached
  + libcublas-dev              12.1.0.26  0      nvidia/label/cuda-12.1.0     Cached
  + libcufft-dev                11.0.2.4  0      nvidia/label/cuda-12.1.0     Cached
  + gds-tools                   1.6.0.25  0      nvidia/label/cuda-12.1.0     Cached
  + libcufile-dev               1.6.0.25  0      nvidia/label/cuda-12.1.0     Cached
  + libcurand-dev              10.3.2.56  0      nvidia/label/cuda-12.1.0     Cached
  + libcusolver-dev            11.4.4.55  0      nvidia/label/cuda-12.1.0     Cached
  + libcusparse-dev            12.0.2.55  0      nvidia/label/cuda-12.1.0     Cached
  + libnpp-dev                 12.0.2.50  0      nvidia/label/cuda-12.1.0     Cached
  + libnvjitlink-dev             12.1.55  0      nvidia/label/cuda-12.1.0     Cached
  + libnvjpeg-dev              12.1.0.39  0      nvidia/label/cuda-12.1.0     Cached
  + cuda-libraries                12.1.0  0      nvidia/label/cuda-12.1.0     Cached
  + cuda-cupti-static            12.1.62  0      nvidia/label/cuda-12.1.0     Cached
  + cuda-compiler                 12.1.0  0      nvidia/label/cuda-12.1.0     Cached
  + cuda-nvvp                    12.1.55  0      nvidia/label/cuda-12.1.0     Cached
  + cuda-command-line-tools       12.1.0  0      nvidia/label/cuda-12.1.0     Cached
  + cuda-nsight-compute           12.1.0  0      nvidia/label/cuda-12.1.0     Cached
  + cuda-cudart-static           12.1.55  0      nvidia/label/cuda-12.1.0     Cached
  + cuda-nvrtc-static            12.1.55  0      nvidia/label/cuda-12.1.0     Cached
  + libcublas-static           12.1.0.26  0      nvidia/label/cuda-12.1.0     Cached
  + libcufft-static             11.0.2.4  0      nvidia/label/cuda-12.1.0     Cached
  + libcufile-static            1.6.0.25  0      nvidia/label/cuda-12.1.0     Cached
  + libcurand-static           10.3.2.56  0      nvidia/label/cuda-12.1.0     Cached
  + libcusolver-static         11.4.4.55  0      nvidia/label/cuda-12.1.0     Cached
  + libcusparse-static         12.0.2.55  0      nvidia/label/cuda-12.1.0     Cached
  + libnpp-static              12.0.2.50  0      nvidia/label/cuda-12.1.0     Cached
  + libnvjpeg-static           12.1.0.39  0      nvidia/label/cuda-12.1.0     Cached
  + cuda-libraries-dev            12.1.0  0      nvidia/label/cuda-12.1.0     Cached
  + cuda-libraries-static         12.1.0  0      nvidia/label/cuda-12.1.0     Cached
  + cuda-visual-tools             12.1.0  0      nvidia/label/cuda-12.1.0     Cached
  + cuda-tools                    12.1.0  0      nvidia/label/cuda-12.1.0     Cached
  + cuda-toolkit                  12.1.0  0      nvidia/label/cuda-12.1.0     Cached
```

è¿™æ˜¯å®‰è£… `cuda-toolkit-12.1.1` çš„åŒ…ï¼š

```bash
  + cuda-documentation         12.1.105  0      nvidia/label/cuda-12.1.1       91kB
  + cuda-nvml-dev              12.1.105  0      nvidia/label/cuda-12.1.1       87kB
  + libnvvm-samples            12.1.105  0      nvidia/label/cuda-12.1.1       33kB
  + cuda-cccl                  12.1.109  0      nvidia/label/cuda-12.1.1        1MB
  + cuda-driver-dev            12.1.105  0      nvidia/label/cuda-12.1.1       17kB
  + cuda-profiler-api          12.1.105  0      nvidia/label/cuda-12.1.1       19kB
  + cuda-cudart                12.1.105  0      nvidia/label/cuda-12.1.1     Cached
  + cuda-nvrtc                 12.1.105  0      nvidia/label/cuda-12.1.1     Cached
  + cuda-opencl                12.1.105  0      nvidia/label/cuda-12.1.1       11kB
  + libcublas                  12.1.3.1  0      nvidia/label/cuda-12.1.1      367MB
  + libcufft                  11.0.2.54  0      nvidia/label/cuda-12.1.1      108MB
  + libcufile                   1.6.1.9  0      nvidia/label/cuda-12.1.1      783kB
  + libcurand                10.3.2.106  0      nvidia/label/cuda-12.1.1       54MB
  + libcusolver              11.4.5.107  0      nvidia/label/cuda-12.1.1      116MB
  + libcusparse              12.1.0.106  0      nvidia/label/cuda-12.1.1      177MB
  + libnpp                    12.1.0.40  0      nvidia/label/cuda-12.1.1      147MB
  + libnvjitlink               12.1.105  0      nvidia/label/cuda-12.1.1     Cached
  + libnvjpeg                  12.2.0.2  0      nvidia/label/cuda-12.1.1        3MB
  + cuda-cupti                 12.1.105  0      nvidia/label/cuda-12.1.1     Cached
  + cuda-cuobjdump             12.1.111  0      nvidia/label/cuda-12.1.1      245kB
  + cuda-cuxxfilt              12.1.105  0      nvidia/label/cuda-12.1.1      302kB
  + cuda-nvcc                  12.1.105  0      nvidia/label/cuda-12.1.1       55MB
  + cuda-nvprune               12.1.105  0      nvidia/label/cuda-12.1.1       67kB
  + cuda-gdb                   12.1.105  0      nvidia/label/cuda-12.1.1        6MB
  + cuda-nvdisasm              12.1.105  0      nvidia/label/cuda-12.1.1       50MB
  + cuda-nvprof                12.1.105  0      nvidia/label/cuda-12.1.1        5MB
  + cuda-nvtx                  12.1.105  0      nvidia/label/cuda-12.1.1     Cached
  + cuda-sanitizer-api         12.1.105  0      nvidia/label/cuda-12.1.1       18MB
  + cuda-nsight                12.1.105  0      nvidia/label/cuda-12.1.1      119MB
  + nsight-compute           2023.1.1.4  0      nvidia/label/cuda-12.1.1      808MB
  + cuda-cudart-dev            12.1.105  0      nvidia/label/cuda-12.1.1      381kB
  + cuda-nvrtc-dev             12.1.105  0      nvidia/label/cuda-12.1.1       12kB
  + cuda-opencl-dev            12.1.105  0      nvidia/label/cuda-12.1.1       59kB
  + libcublas-dev              12.1.3.1  0      nvidia/label/cuda-12.1.1       76kB
  + libcufft-dev              11.0.2.54  0      nvidia/label/cuda-12.1.1       14kB
  + gds-tools                   1.6.1.9  0      nvidia/label/cuda-12.1.1       43MB
  + libcufile-dev               1.6.1.9  0      nvidia/label/cuda-12.1.1       13kB
  + libcurand-dev            10.3.2.106  0      nvidia/label/cuda-12.1.1      460kB
  + libcusolver-dev          11.4.5.107  0      nvidia/label/cuda-12.1.1       51kB
  + libcusparse-dev          12.1.0.106  0      nvidia/label/cuda-12.1.1      178MB
  + libnpp-dev                12.1.0.40  0      nvidia/label/cuda-12.1.1      525kB
  + libnvjitlink-dev           12.1.105  0      nvidia/label/cuda-12.1.1       15MB
  + libnvjpeg-dev              12.2.0.2  0      nvidia/label/cuda-12.1.1       13kB
  + cuda-libraries               12.1.1  0      nvidia/label/cuda-12.1.1        2kB
  + cuda-cupti-static          12.1.105  0      nvidia/label/cuda-12.1.1       12MB
  + cuda-compiler                12.1.1  0      nvidia/label/cuda-12.1.1        1kB
  + cuda-nvvp                  12.1.105  0      nvidia/label/cuda-12.1.1      120MB
  + cuda-command-line-tools      12.1.1  0      nvidia/label/cuda-12.1.1        1kB
  + cuda-nsight-compute          12.1.1  0      nvidia/label/cuda-12.1.1        1kB
  + cuda-cudart-static         12.1.105  0      nvidia/label/cuda-12.1.1      948kB
  + cuda-nvrtc-static          12.1.105  0      nvidia/label/cuda-12.1.1       18MB
  + libcublas-static           12.1.3.1  0      nvidia/label/cuda-12.1.1      389MB
  + libcufft-static           11.0.2.54  0      nvidia/label/cuda-12.1.1      199MB
  + libcufile-static            1.6.1.9  0      nvidia/label/cuda-12.1.1        3MB
  + libcurand-static         10.3.2.106  0      nvidia/label/cuda-12.1.1       55MB
  + libcusolver-static       11.4.5.107  0      nvidia/label/cuda-12.1.1       76MB
  + libcusparse-static       12.1.0.106  0      nvidia/label/cuda-12.1.1      185MB
  + libnpp-static             12.1.0.40  0      nvidia/label/cuda-12.1.1      143MB
  + libnvjpeg-static           12.2.0.2  0      nvidia/label/cuda-12.1.1        3MB
  + cuda-libraries-dev           12.1.1  0      nvidia/label/cuda-12.1.1        2kB
  + cuda-libraries-static        12.1.1  0      nvidia/label/cuda-12.1.1        2kB
  + cuda-visual-tools            12.1.1  0      nvidia/label/cuda-12.1.1        1kB
  + cuda-tools                   12.1.1  0      nvidia/label/cuda-12.1.1        1kB
  + cuda-toolkit                 12.1.1  0      nvidia/label/cuda-12.1.1        2kB
```

å¯¹æ¯”å‘ç°æ˜¯ `cuda-12.1.1` æ‰å¯¹çš„ä¸ŠCUDAç‰ˆæœ¬12.1çš„Pytorchã€‚ä½†æ˜¯æˆ‘ä»¬åœ¨å®‰è£…çš„æ—¶å€™ï¼Œå…ˆå®‰è£…CUDAç‰ˆæœ¬12.1çš„Pytorchï¼Œå†å®‰è£… `cuda-12.1.1` ä¼šå‡ºç°å†²çªé—®é¢˜ï¼š

```bash
â””â”€ pytorch-cuda is not installable because it requires
   â””â”€ libcublas >=12.1.0.26,<12.1.3.1 , which conflicts with any installable versions previously reported.
```

ä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥æ­»çš„CUDAç‰ˆæœ¬12.1çš„Pytorchçš„ `libcublas` éœ€è¦é€‚é… `cuda-toolkit-12.1.0` ï¼Œä½†æ˜¯å…¶çš„ `cuda-cudart` ç­‰åº“åˆéœ€è¦é€‚é… `cuda-toolkit-12.1.1` 

å¯ä»¥çœ‹åˆ° pytorch-cuda å¼ºè¦æ±‚ `libcublas >=12.1.0.26,<12.1.3.1`ï¼Œæˆ‘ä»¬åªå¥½è¿å°± pytorchï¼Œå®‰è£…12.1.0çš„CUDAï¼Œä½†æ˜¯å‘¢ï¼==æˆ‘ä»¬å¯ä»¥ä¿®æ”¹Pytorchå®˜æ–¹ç»™å‡ºçš„ `nvidia` channel ä¸º `nvidia/label/cuda-12.1.0`==

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

```bash
mamba install pytorch==2.4.1 torchvision==0.19.1 torchaudio==2.4.1 pytorch-cuda=12.1 -c pytorch -c nvidia/label/cuda-12.1.0
```

å…¶å°±ä¼šå®‰è£…ä¸æˆ‘ä»¬å®‰è£…çš„ `cuda-toolkit-12.1.0` ä¸€æ ·çš„ä¸€äº› cuda åº“äº†ï¼

```bash
  + pytorch-mutex         1.0  cuda                          pytorch                      Cached
  + libcublas       12.1.0.26  0                             nvidia/label/cuda-12.1.0     Cached
  + libcufft         11.0.2.4  0                             nvidia/label/cuda-12.1.0     Cached
  + libcusolver     11.4.4.55  0                             nvidia/label/cuda-12.1.0     Cached
  + libcusparse     12.0.2.55  0                             nvidia/label/cuda-12.1.0     Cached
  + libnpp          12.0.2.50  0                             nvidia/label/cuda-12.1.0     Cached
  + libnvjpeg       12.1.0.39  0                             nvidia/label/cuda-12.1.0        3MB
  + cuda-cudart       12.1.55  0                             nvidia/label/cuda-12.1.0     Cached
  + cuda-nvrtc        12.1.55  0                             nvidia/label/cuda-12.1.0       21MB
  + cuda-opencl       12.1.56  0                             nvidia/label/cuda-12.1.0       11kB
  + libcufile        1.6.0.25  0                             nvidia/label/cuda-12.1.0      782kB
  + libcurand       10.3.2.56  0                             nvidia/label/cuda-12.1.0       54MB
  + cuda-cupti        12.1.62  0                             nvidia/label/cuda-12.1.0        5MB
  + cuda-nvtx         12.1.66  0                             nvidia/label/cuda-12.1.0       58kB
  + cuda-version         12.1  h1d6eff3_3                    conda-forge                    21kB
  + ffmpeg                4.3  hf484d3e_0                    pytorch                      Cached
  + libjpeg-turbo       2.0.0  h9bf148f_0                    pytorch                      Cached
  + libnvjitlink     12.1.105  hd3aeb46_0                    conda-forge                    16MB
  + cuda-libraries     12.1.0  0                             nvidia/label/cuda-12.1.0     Cached
  + cuda-runtime       12.1.0  0                             nvidia/label/cuda-12.1.0     Cached
  + pytorch-cuda         12.1  ha16c6d3_6                    pytorch                      Cached
  + pytorch             2.4.1  py3.12_cuda12.1_cudnn9.1.0_0  pytorch                      Cached
  + torchtriton         3.0.0  py312                         pytorch                      Cached
  + torchvision        0.19.1  py312_cu121                   pytorch                      Cached
  + torchaudio          2.4.1  py312_cu121                   pytorch                      Cached
```

åˆ°è¿™é‡Œï¼Œé—®é¢˜å°±è§£å†³äº†ï¼šæˆ‘ä»¬ä¹‹åè¦å®‰è£… pytorch-cuda å’Œ cuda-toolkit æ—¶ï¼Œåªéœ€è¦æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼ˆé¡ºåºåº”è¯¥ä¸é‡è¦äº†ï¼‰ï¼š

```bash
mamba install pytorch==2.4.1 torchvision==0.19.1 torchaudio==2.4.1 pytorch-cuda=12.1 -c pytorch -c nvidia/label/cuda-12.1.0
mamba install nvidia/label/cuda-12.1.0::cuda-toolkit -c nvidia/label/cuda-12.1.0
```

å®‰è£… cuda-toolkit å°±ç›¸å½“äºåœ¨å®‰è£…å®Œ pytorch-cuda çš„éœ€è¦çš„éƒ¨åˆ† cuda åº“åï¼Œè¿›è¡Œäº†è¡¥å……å®‰è£…ï¼Œéƒ½æ˜¯åŒä¸€ä¸ª channel çš„å½“ç„¶å°±ä¸ä¼šæœ‰é—®é¢˜äº†

## 1.2.6 CUDA error: CUBLAS_STATUS_NOT_SUPPORTED

ä½¿ç”¨ä¸€ä¸‹å®˜æ–¹å‘½ä»¤å®‰è£… pytorch=1.11.0+cuda=11.3 

```bash
mamba install pytorch==1.11.0 torchvision==0.12.0 torchaudio==0.11.0 cudatoolkit=11.3 -c pytorch
```

è¿è¡Œ `torch.einsum` è¿™ä¸ªå‡½æ•°æ—¶ï¼Œå‡ºç°äº†ä»¥ä¸‹æŠ¥é”™ï¼š

```bash
  File "/mnt/data4/home/xxxx/eg3d/dataset_preprocessing/ffhq/Deep3DFaceRecon_pytorch/models/bfm.py", line 96, in compute_shape
    id_part = torch.einsum('ij,aj->ai', self.id_base, id_coeff)
  File "/mnt/data/home/xxxx/miniforge3/envs/deep3d_pytorch/lib/python3.8/site-packages/torch/functional.py", line 330, in einsum
    return _VF.einsum(equation, operands)  # type: ignore[attr-defined]
RuntimeError: CUDA error: CUBLAS_STATUS_NOT_SUPPORTED when calling `cublasSgemmStridedBatched( handle, opa, opb, m, n, k, &alpha, a, lda, stridea, b, ldb, strideb, &beta, c, ldc, stridec, num_batches)`
```

è§£å†³æ–¹æ¡ˆï¼š

æ¢æˆ pip å®‰è£… pytorchï¼ˆæ„Ÿè§‰æ˜¯å› ä¸ºè¿™ä¸ªè€ç‰ˆæœ¬çš„ Conda å®‰è£… cudatoolkit æ–¹æ³•æœ‰é—®é¢˜ï¼Œåˆ°äº†pytorch v1.13.0 æ”¯æŒ CUDA 11.7 ä¹‹åï¼Œå°±æ˜¯å®‰è£… pytorch-cuda äº†ï¼Œåº”è¯¥å°±æ²¡é—®é¢˜äº†ï¼‰

```bash
pip install torch==1.11.0+cu113 torchvision==0.12.0+cu113 torchaudio==0.11.0 --extra-index-url https://download.pytorch.org/whl/cu113
```

