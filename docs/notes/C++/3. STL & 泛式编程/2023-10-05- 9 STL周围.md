---
title: 9 STLå‘¨å›´
createTime: 2023/10/05 20:19:48
permalink: /cpp/bqm27pdt/
---



## 9 STLå‘¨å›´

### 9.1 ä¸‡ç”¨Hash Function

Hash Functionçš„å¸¸è§„å†™æ³•ï¼šå…¶ä¸­ `hash_val` å°±æ˜¯ä¸‡ç”¨Hash Function

```cpp
class CustumerHash
{ 
public:
	size_t operator()(const Customer& c) const
	{ return hash_val(c.fname(), c.lname(), c.no()); }
};
```

<!--more-->

> è¿˜å¯ä»¥ç›´æ¥ç”¨å‡½æ•°å®ç°ï¼Œæˆ–è€…å†™ä¸€ä¸ª `hash` çš„ç‰¹åŒ–ç‰ˆæœ¬

åŸç†ï¼š

é€šè¿‡ä¸‰ä¸ªå‡½æ•°é‡è½½å®ç°ä»ç»™å…¥æ•°æ®ä¸­é€ä¸€æå–æ¥ä¸æ–­æ”¹å˜ `seed`

```cpp
// ç¬¬ä¸€ä¸ªå‡½æ•° é¦–å…ˆè¿›å…¥è¯¥å‡½æ•°
template <typename... Types>
inline size_t hash_val(const Type&... args)
{
	size_t seed = 0; // è®¾ç½®åˆå§‹seed
	hash_val(seed, args...); // è¿›å…¥ç¬¬äºŒä¸ªå‡½æ•°
	return seed; // seedå°±æ˜¯æœ€åçš„HashCode
}

// ç¬¬äºŒä¸ªå‡½æ•° è¯¥å‡½æ•°ä¸­é€ä¸€æå–ä¸€ä¸ªå‚æ•°
template <typename T, typename... Types>
inline void hash_val(size_t& seed, const T& val, const Types&... args)
{
	hash_combine(seed, val); // é€ä¸€å–valï¼Œæ”¹å˜seed
	hash_val(seed, args...); // é€’å½’è°ƒç”¨è‡ªå·±ï¼Œç›´åˆ°å–å®Œè¿›å…¥ç¬¬ä¸‰ä¸ªå‡½æ•°
}

// ç¬¬ä¸‰ä¸ªå‡½æ•°
template <typename T>
inline void hash_val(size_t& seed, const T& val)
{
	hash_combine(seed, val); // å–æœ€åä¸€ä¸ªvalï¼Œæ”¹å˜seed
}

// æ”¹å˜seedçš„å‡½æ•°
template <typename T>
inline void hash_combine(size_t& seed, const T& val)
{
    // ä¹±ä¸ƒå…«ç³Ÿçš„è¿ç®—ï¼Œè¶Šä¹±è¶Šå¥½
	seed ^= hash<T>()(val) + 0x9e3779b9 + (seed<<6) + (seed>>2);
}
```

> C++11ä¸­ *variadic templates*ï¼š
>
> ä»ä¼ å…¥çš„å†…å®¹ï¼ˆä»»æ„ä¸ªæ•°ï¼Œä»»æ„å…ƒç´ ç±»å‹ï¼‰åˆ†ä¸ºä¸€ä¸ªå’Œå…¶ä»–ï¼Œé€’å½’å†åˆ†ä¸ºä¸€ä¸ªå’Œå…¶ä»–Â·Â·Â·Â·Â·Â·

> *0x9e3779b9*ï¼šæ˜¯é»„é‡‘æ¯”ä¾‹ï¼



### 9.2 Tuple

å¯ä»¥å°†ä¸€äº›ä¸œè¥¿ç»„åˆåœ¨ä¸€èµ·

#### 9.2.1 ç”¨ä¾‹

- åˆ›å»º `tuple`

  ```cpp
  tuple<string, int, int, complex<double>> t; 
  
  tuple<int, float, string> t1(41, 6.3, "nico"); 
  
  auto t2 = make_tuple(22, 44, "stacy");
  ```

- è¾“å‡º `tuple`

  ```cpp
  // è¾“å‡ºt1ä¸­çš„ç¬¬ä¸€ä¸ª
  cout << get<0>(t1) << endl; // 41
  cout << t << endl; // åœ¨VS2022ä¸Šå¹¶æ²¡æœ‰<<çš„é‡è½½
  ```

- è¿ç®—

  ```cpp
  t1 = t2;
  
  if(t1 < t2) // ä»¥ç‰¹å®šçš„æ–¹å¼è¿›è¡Œçš„æ¯”è¾ƒ
  {
      ...
  }
  ```

- ç»‘å®šè§£åŒ…

  ```cpp
  tuple<int, float, string> t3(77, 1.1, "more light");
  int i;
  float f;
  string s;
  
  tie(i, f, s) = t3; // i == 77, f == 1.1, s == "more light"
  ```

- ```cpp
  // tupleé‡Œæœ‰å¤šå°‘ç±»å‹
  tuple_size< tuple<int, float, string> >::value; // 3
  
  // å–tupleé‡Œé¢çš„ç±»å‹ï¼Œå‰é¢ä¸€å †ä»£è¡¨float
  tuple_element<1, TupleType>::type fl = 1.0; // float fl = 1.0;
  ```

#### 9.2.2 åŸç†

ä¾ç„¶æ˜¯ä½¿ç”¨ *variadic templates*ï¼Œé€šè¿‡é€’å½’ç»§æ‰¿ï¼Œä¸æ–­ä» `...` ä¸­æå–å†…å®¹

```cpp
// ç©ºçš„tuple
template <> class tuple<> {}; // ç›´åˆ°å–å®Œ

// tupleä¸»ä½“
template <typename Head, typename... Tail>
class tuple<Head, Tail...>
	: private tuple<Tail...> // é€’å½’ç»§æ‰¿
{
    typedef tuple<Tail...> inherited;
public:
	tuple() {}
	tuple(Head v, Tail... vtail) 
        : m_head(v), inherited(vtail...) {}
	...
protected:
	Head m_head; // æ¯æ¬¡å–å‡ºçš„å…ƒç´ 
};
```

<img src="https://raw.githubusercontent.com/PLUS-WAVE/blog-image/master/img/blog/2023-09-23/image-20230923111219018.png" alt="image-20230923111219018" style="zoom: 80%;" /> ğŸ‘ˆğŸ»ä¸æ–­çš„ç»§æ‰¿å°±å¯ä»¥å®ç°ä¸åŒç±»å‹çš„ç»„åˆäº†



å…¶ä½™å‡½æ•°ï¼š

```cpp
...
{
public:
    ...
	Head head() { return m_head; }
	inherited& tail() { return *this; } // é€šè¿‡è½¬å‹è·å¾—Tailéƒ¨åˆ†
    ...
};
```

![image-20230923112317405](https://raw.githubusercontent.com/PLUS-WAVE/blog-image/master/img/blog/2023-09-23/image-20230923112317405.png) ä¸€èˆ¬ä¸è¿™ä¹ˆç”¨



### 9.3 type traits

#### 9.3.1 ç”¨ä¾‹

**GCC2.9**ä¸­ï¼š

é»˜è®¤çš„ `__type_traits` è¿›è¡Œäº†ä¸€ç³»åˆ—**æ³›åŒ–**çš„è®¾å®šï¼ˆ*trivial* æ˜¯ä¸é‡è¦çš„æ„æ€ï¼‰

```cpp
 struct __true_type {};
struct __false_type {};

template <class type>
struct __type_traits
{
	typedef __true_type this_dummy_member_must_be_first;
	typedef __false_type has_trivial_default_constructor;
	typedef __false_type has_trivial_copy_constructor;
	typedef __false_type has_trivial_assignment_operator;
	typedef __false_type has_trivial_destructor;
	typedef __false_type is_POD_type; // Plain Old Data ç±»ä¼¼Cçš„struct
};
```

è¿˜ä¼šé€šè¿‡**ç‰¹åŒ–**æ¥å®ç°é’ˆå¯¹ä¸åŒç±»å‹çš„è®¾å®šï¼Œä¾‹

```cpp
template <> struct __type_traits<int>
{
	typedef __true_type has_trivial_default_constructor;
	typedef __true_type has_trivial_copy_constructor;
	typedef __true_type has_trivial_assignment_operator;
	typedef __true_type has_trivial_destructor;
	typedef __true_type is_POD_type;
};
```

**C++11**ä¸­ï¼š
æœ‰äº†å¾ˆå¤šä¸ª *type traits*ï¼Œå¯ä»¥å›ç­”æ›´å¤šé—®é¢˜

æµ‹è¯•ï¼š

```cpp
cout << is_void<T>::value << endl;
cout << is_integral<T>::value << endl;
cout << is_floating_point<T>::value << endl;
cout << is_array<T>::value << endl;
...
```

<img src="https://raw.githubusercontent.com/PLUS-WAVE/blog-image/master/img/blog/2023-09-23/image-20230923192837871.png" alt="image-20230923192837871" style="zoom:67%;" />

ä¸è®ºæ˜¯ä»€ä¹ˆç±»å‹éƒ½å¯ä»¥**è‡ªåŠ¨æ£€æµ‹**å®ƒçš„ *traits*ï¼Œéå¸¸å‰å®³ï¼ï¼ˆé‡Œé¢æœ‰è™šå‡½æ•°â€”â€”å°±èƒ½è‡ªåŠ¨æ£€æµ‹å‡ºå®ƒæœ‰å¤šæ€æ€§ï¼‰



#### 9.3.2 åŸç†

æ¨¡æ¿çš„ä½œç”¨

ä¾‹ `is_integral`

ä¾ç„¶æ˜¯é‡‡ç”¨çš„ä¸€ç§é—®ç­”çš„æ–¹å¼å®ç°çš„

```cpp
template <typename _Tp>
struct is_integral
	:public __is_intagral_helper<typename remove_cv<_Tp>::type>::type
{ };
```

é¦–å…ˆ `remove_cv`ï¼ˆ`const` å’Œ `volatile`ï¼‰

```cpp
// é€šè¿‡åç‰¹åŒ–å®ç°remove const
template <typename _Tp>
struct remove_const
{ typedef _Tp type };

template <typename _Tp>
struct remove_const<_Tp const>
{ typedef _Tp type };

// remove volatile åŒç†
```

å†é€šè¿‡ `__is_intagral_helper` è¿›è¡Œé—®ç­”

```cpp
// é€šè¿‡åç‰¹åŒ–å®ç°
template <typename>
struct __is_integral_helper
	:public false_type { };

template <>
struct __is_integral_helper<bool>
	:public true_type { };

template <>
struct __is_integral_helper<int>
	:public true_type { };

template <>
struct __is_integral_helper<long>
	:public true_type { };

...
```

> å…¶ä»–æ·±å…¥ class å†…éƒ¨çš„ä¸€äº› traits æ¯”å¦‚æ˜¯å¦æœ‰è™šå‡½æ•°ï¼Œæ˜¯å¦æ˜¯ä¸€ä¸ªç±»ï¼Œæ˜¯å¦æ˜¯PODç­‰ç­‰ï¼Œå…¶å®ç°å¯èƒ½éƒ½ä¸ç¼–è¯‘å™¨æœ‰å…³



### 9.4 move

*moveable class* ä¸­æœ‰ï¼š

```cpp
// move ctor
MyString(MyString&& str) noexcept // ç”¨&&ä¸æ™®é€šç‰ˆæœ¬åŒºåˆ«å¼€
    : _data(str._data), _len(str._len)
{
    str._len = 0;
    str._data = NULL; // é¿å…ææ„å‡½æ•°é‡Šæ”¾èµ„æº
}

// move assignment
MyString& operator=(MyString&& str) noexcept
{
    if (this != &str)
    {
        _len = str._len;
        _data = str._data;
        str._len = 0;
        str._data = NULL; // é¿å…ææ„å‡½æ•°é‡Šæ”¾èµ„æº
    }
    return *this;
}

// dtor
virtual ~MyString()
{
    if(_data) delete _data; // ä¸€å®šè¦æ£€æŸ¥
}
```

```cpp
MyString C11(C1); // ctor
MyString C12(move(C1)); // move ctor
```

<img src="https://raw.githubusercontent.com/PLUS-WAVE/blog-image/master/img/blog/2023-09-24/image-20230924094317369.png" alt="image-20230924094317369"  /> æ˜¯==<u>æµ…æ‹·è´</u>==ï¼Œå¹¶ä¸”æŠŠä¹‹å‰çš„æŒ‡å‘å»é™¤äº†

å¯¹äº vector è¿™æ ·çš„å®¹å™¨ï¼Œå…¶ç”¨ move å°±åªæ˜¯ swap äº†ä¸‰æ ¹æŒ‡é’ˆï¼Œéå¸¸å¿«ï¼

> move ä¹‹å<u>åŸæ¥çš„ä¸œè¥¿ä¸èƒ½å†ä½¿ç”¨</u>ï¼Œæ¯”å¦‚æ‹¿æ•°æ®æ’å…¥å®¹å™¨ï¼Œç”¨<u>ä¸´æ—¶å¯¹è±¡</u>ï¼Œç¼–è¯‘å™¨çœ‹åˆ°å°±==ä¼šè‡ªåŠ¨ä½¿ç”¨== move ç‰ˆæœ¬çš„
>
> `MyString C11(C1);` æ—¶ï¼Œåˆ›å»ºäº†ä¸€ä¸ªå®ä¾‹ C11ï¼Œç¼–è¯‘å™¨å°±ä¸çŸ¥é“æ˜¯å¦èƒ½ç”¨ moveï¼Œå°±éœ€è¦è‡ªå·± `MyString C12(move(C1));` ä½¿ç”¨ moveï¼Œä½†æ³¨æ„ä¹‹å==<u>ä¸€å®šä¸èƒ½ç”¨åŸæ¥çš„</u> `C1`==

> `&&`ï¼ˆå³å€¼å¼•ç”¨ï¼‰è¿™æ˜¯C++11å¼•å…¥çš„ç‰¹æ€§ï¼Œå³å€¼å¼•ç”¨ç”¨äºå¤„ç†ä¸´æ—¶å¯¹è±¡æˆ–å°†èµ„æºæ‰€æœ‰æƒè½¬ç§»ç»™å…¶ä»–å¯¹è±¡ï¼Œä»¥æé«˜æ€§èƒ½å’Œèµ„æºç®¡ç†